{"is_source_file": true, "format": "Python", "description": "This file contains FastAPI dependencies for JWT validation compatible with Keycloak, including user authentication, role extraction, and token validation logic.", "external_files": ["app.auth.oidc", "app.core.config"], "external_methods": ["jwt.get_unverified_header", "jwt.decode", "jwt.algorithms.RSAAlgorithm.from_jwk", "fetch_jwks"], "published": ["get_current_user", "require_roles"], "classes": [{"name": "AuthenticatedUser", "description": "Immutable data class representing an authenticated user extracted from a JWT token."}], "methods": [{"name": "str _resolve_audience(settings: Settings)", "description": "Resolves the JWT audience from settings, with fallback to deprecated keys.", "scope": "", "scopeKind": ""}, {"name": "Set[str] _extract_roles_from_keycloak_claims(claims: Dict[str, Any], *, client_id: str)", "description": "Extracts realm and client roles from Keycloak JWT claims.", "scope": "", "scopeKind": ""}, {"name": "Any _get_signing_key_from_jwks(token: str, jwks: Dict[str, Any])", "description": "Retrieves the appropriate public signing key from a JWKS based on token's 'kid'.", "scope": "", "scopeKind": ""}, {"name": "AuthenticatedUser _dependency(user: AuthenticatedUser = Depends(get_current_user))", "scope": "require_roles", "scopeKind": "function", "description": "unavailable"}, {"name": "AuthenticatedUser get_current_user( credentials: Optional[HTTPAuthorizationCredentials] = Depends(bearer_scheme), settings: Settings = Depends(get_settings), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Any require_roles(required: Sequence[str])", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["Depends", "jwt.get_unverified_header", "jwt.decode", "fetch_jwks", "jwt.algorithms.RSAAlgorithm.from_jwk", "HTTPException"], "search-terms": ["FastAPI auth dependencies", "Keycloak JWT validation", "fetch_jwks", "AuthenticatedUser", "get_current_user"], "state": 2, "file_id": 32, "knowledge_revision": 74, "git_revision": "2f138bff749f10b53a0f8b62224e1e45a159135e", "revision_history": [{"71": "51e2f0274e3519ee6277de5e8d3429874852c597"}, {"74": "2f138bff749f10b53a0f8b62224e1e45a159135e"}], "ctags": [{"_type": "tag", "name": "AuthenticatedUser", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^class AuthenticatedUser:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_dependency", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    async def _dependency(user: AuthenticatedUser = Depends(get_current_user)) -> AuthenticatedU/", "file": true, "language": "Python", "typeref": "typename:AuthenticatedUser", "kind": "function", "signature": "(user: AuthenticatedUser = Depends(get_current_user))", "scope": "require_roles", "scopeKind": "function"}, {"_type": "tag", "name": "_extract_roles_from_keycloak_claims", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _extract_roles_from_keycloak_claims(claims: Dict[str, Any], *, client_id: str) -> Set[str]:$/", "language": "Python", "typeref": "typename:Set[str]", "kind": "function", "signature": "(claims: Dict[str, Any], *, client_id: str)"}, {"_type": "tag", "name": "_get_signing_key_from_jwks", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _get_signing_key_from_jwks(token: str, jwks: Dict[str, Any]) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(token: str, jwks: Dict[str, Any])"}, {"_type": "tag", "name": "_resolve_audience", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _resolve_audience(settings: Settings) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(settings: Settings)"}, {"_type": "tag", "name": "bearer_scheme", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^bearer_scheme = HTTPBearer(auto_error=False)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^async def get_current_user($/", "language": "Python", "typeref": "typename:AuthenticatedUser", "kind": "function", "signature": "( credentials: Optional[HTTPAuthorizationCredentials] = Depends(bearer_scheme), settings: Settings = Depends(get_settings), )"}, {"_type": "tag", "name": "raw_claims", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    raw_claims: Dict[str, Any] = field(default_factory=dict)$/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "AuthenticatedUser", "scopeKind": "class"}, {"_type": "tag", "name": "require_roles", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def require_roles(required: Sequence[str]) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(required: Sequence[str])"}, {"_type": "tag", "name": "roles", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    roles: FrozenSet[str] = field(default_factory=frozenset)$/", "language": "Python", "typeref": "typename:FrozenSet[str]", "kind": "variable", "scope": "AuthenticatedUser", "scopeKind": "class"}], "hash": "7da4a5665c3eef245d706c708708a7a1", "format-version": 4, "code-base-name": "rest-api-modernized", "filename": "app/auth/dependencies.py", "fields": [{"name": "bearer_scheme = HTTPBearer(auto_error=False)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Any] raw_claims", "scope": "AuthenticatedUser", "scopeKind": "class", "description": "unavailable"}, {"name": "FrozenSet[str] roles", "scope": "AuthenticatedUser", "scopeKind": "class", "description": "unavailable"}]}