{"is_source_file": true, "format": "Python", "description": "This file defines dependencies and helper functions for authenticating users via Keycloak-compatible JWT tokens in a FastAPI application. It includes data classes for user representation, role extraction, and token validation logic.", "external_files": ["app.auth.oidc", "app.core.config"], "external_methods": ["fetch_jwks", "get_settings", "jwt.get_unverified_header", "jwt.decode", "jwt.algorithms.RSAAlgorithm.from_jwk"], "published": ["get_current_user", "require_roles"], "classes": [{"name": "AuthenticatedUser", "description": "Represents the authenticated principal extracted from an access token."}], "methods": [{"name": "str _resolve_audience(settings: Settings)", "description": "Resolves the audience string from current settings, using fallback to deprecated environment variables.", "scope": "", "scopeKind": ""}, {"name": "Set[str] _extract_roles_from_keycloak_claims(claims: Dict[str, Any], *, client_id: str)", "description": "Extracts roles for a user from Keycloak-specific JWT claims, including realm roles and resource roles.", "scope": "", "scopeKind": ""}, {"name": "Any _get_signing_key_from_jwks(token: str, jwks: Dict[str, Any])", "description": "Identifies the correct public key from the JWKS to verify the JWT signature, based on the token's 'kid' header.", "scope": "", "scopeKind": ""}, {"name": "AuthenticatedUser get_current_user( credentials: Optional[HTTPAuthorizationCredentials] = Depends(bearer_scheme), settings: Settings = Depends(get_settings), )", "description": "Dependency function that validates a Bearer JWT token and returns an AuthenticatedUser object if verified.", "scope": "", "scopeKind": ""}, {"name": "Any require_roles(required: Sequence[str])", "description": "Creates a dependency that enforces role-based access control, requiring the current user to have at least one specified role.", "scope": "", "scopeKind": ""}, {"name": "AuthenticatedUser _dependency(user: AuthenticatedUser = Depends(get_current_user))", "scope": "require_roles", "scopeKind": "function", "description": "unavailable"}], "calls": ["Depends", "fetch_jwks", "get_settings", "jwt.get_unverified_header", "jwt.decode", "jwt.algorithms.RSAAlgorithm.from_jwk"], "search-terms": ["JWT validation", "FastAPI auth dependencies", "Keycloak roles extraction", "JWKS key selection", "authenticated user data class", "role-based access control"], "state": 2, "file_id": 32, "knowledge_revision": 71, "git_revision": "51e2f0274e3519ee6277de5e8d3429874852c597", "ctags": [{"_type": "tag", "name": "AuthenticatedUser", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^class AuthenticatedUser:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_dependency", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    async def _dependency(user: AuthenticatedUser = Depends(get_current_user)) -> AuthenticatedU/", "file": true, "language": "Python", "typeref": "typename:AuthenticatedUser", "kind": "function", "signature": "(user: AuthenticatedUser = Depends(get_current_user))", "scope": "require_roles", "scopeKind": "function"}, {"_type": "tag", "name": "_extract_roles_from_keycloak_claims", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _extract_roles_from_keycloak_claims(claims: Dict[str, Any], *, client_id: str) -> Set[str]:$/", "language": "Python", "typeref": "typename:Set[str]", "kind": "function", "signature": "(claims: Dict[str, Any], *, client_id: str)"}, {"_type": "tag", "name": "_get_signing_key_from_jwks", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _get_signing_key_from_jwks(token: str, jwks: Dict[str, Any]) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(token: str, jwks: Dict[str, Any])"}, {"_type": "tag", "name": "_resolve_audience", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def _resolve_audience(settings: Settings) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(settings: Settings)"}, {"_type": "tag", "name": "bearer_scheme", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^bearer_scheme = HTTPBearer(auto_error=False)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^async def get_current_user($/", "language": "Python", "typeref": "typename:AuthenticatedUser", "kind": "function", "signature": "( credentials: Optional[HTTPAuthorizationCredentials] = Depends(bearer_scheme), settings: Settings = Depends(get_settings), )"}, {"_type": "tag", "name": "raw_claims", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    raw_claims: Dict[str, Any] = field(default_factory=dict)$/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "AuthenticatedUser", "scopeKind": "class"}, {"_type": "tag", "name": "require_roles", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^def require_roles(required: Sequence[str]) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(required: Sequence[str])"}, {"_type": "tag", "name": "roles", "path": "/home/kavia/workspace/code-generation/rest-api-modernized/app/auth/dependencies.py", "pattern": "/^    roles: FrozenSet[str] = field(default_factory=frozenset)$/", "language": "Python", "typeref": "typename:FrozenSet[str]", "kind": "variable", "scope": "AuthenticatedUser", "scopeKind": "class"}], "hash": "2e363901182fcd2435dfb1fa6e77386d", "format-version": 4, "code-base-name": "rest-api-modernized", "filename": "app/auth/dependencies.py", "fields": [{"name": "bearer_scheme = HTTPBearer(auto_error=False)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Any] raw_claims", "scope": "AuthenticatedUser", "scopeKind": "class", "description": "unavailable"}, {"name": "FrozenSet[str] roles", "scope": "AuthenticatedUser", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"71": "51e2f0274e3519ee6277de5e8d3429874852c597"}]}